<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×ª×™×§×•×Ÿ ×‘×¢×™×™×ª ×”×ª×¤×¨×™×˜ ×”×¦×£</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background: #f0f8ff;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .problem-description {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .fix-description {
            background: #d4edda;
            border: 2px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .test-area {
            background: #e3f2fd;
            border: 3px solid #2196f3;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            font-size: 18px;
            line-height: 2;
            user-select: text;
        }
        .steps {
            background: #f8f9fa;
            border: 2px solid #6c757d;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .console {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            direction: ltr;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ×‘×“×™×§×ª ×ª×™×§×•×Ÿ - ×‘×¢×™×™×ª ×”×ª×¤×¨×™×˜ ×”×¦×£</h1>
        
        <div class="problem-description">
            <h3>ğŸš¨ ×”×‘×¢×™×” ×©×“×•×•×—×”:</h3>
            <p><strong>"×©×× ×™ ×œ×•×—×¥ ×¢×œ ×”×ª×¤×¨×™×˜ ×”×¦×£ ×”×•× × ×¡×’×¨ ×•× ×¤×ª×— ××—×“×© ×•×œ× × ×¤×ª×—×ª ×—×œ×•× ×™×ª ×¡×™×›×•×"</strong></p>
            <p>×–×” ××•××¨ ×©×™×© ×”×ª× ×’×©×•×ª ×‘×™×Ÿ event listeners ×©×’×•×¨××ª ×œ×ª×¤×¨×™×˜ ×œ×”×¡×ª×‘×š ×‘××§×•× ×œ×¤×ª×•×— ××ª ×”×“×™××œ×•×’.</p>
        </div>

        <div class="fix-description">
            <h3>âœ… ×”×ª×™×§×•×Ÿ ×©×‘×•×¦×¢:</h3>
            <ul>
                <li>ğŸ›‘ ×”×•×¡×¤×ª `stopImmediatePropagation()` ×œ×›×¤×ª×•×¨ ×”×ª×¤×¨×™×˜</li>
                <li>ğŸ›¡ï¸ ×× ×™×¢×ª text selection events ×¢×œ ×”×ª×¤×¨×™×˜ ×¢×¦××•</li>
                <li>ğŸ¯ ×©×™×¤×•×¨ ×”×œ×•×’×™×§×” ×©×œ `handleMouseDown` - ×œ× ××¡×ª×™×¨ ×× ×œ×•×—×¦×™× ×¢×œ ×”×ª×¤×¨×™×˜</li>
                <li>ğŸ“± ×”×•×¡×¤×ª `user-select: none` ×œ×›×¤×ª×•×¨</li>
                <li>ğŸ” ×”×•×¡×¤×ª ×‘×“×™×§×” ×‘-`handleTextSelection` ×œ×× ×™×¢×ª ××™×¨×•×¢×™× ××”×ª×¤×¨×™×˜</li>
            </ul>
        </div>

        <div class="steps">
            <h3>ğŸ“‹ ×¦×¢×“×™ ×‘×“×™×§×”:</h3>
            <ol>
                <li><strong>×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×”×›×—×•×œ ×œ××˜×”</strong> - ×××•×¨ ×œ×”×•×¤×™×¢ ×ª×¤×¨×™×˜ ×¦×£</li>
                <li><strong>×œ×—×¥ ×¢×œ "ğŸ“„ ×¡×›× ×˜×§×¡×˜ ××¡×•××Ÿ"</strong> - ×”×“×™××œ×•×’ ×××•×¨ ×œ×”×™×¤×ª×— ××™×“</li>
                <li><strong>×‘×“×•×§ ×©×”×ª×¤×¨×™×˜ ×œ× × ×¡×’×¨ ×•× ×¤×ª×— ××—×“×©</strong></li>
                <li><strong>×‘×“×•×§ ×©×”×“×™××œ×•×’ ××¦×™×’ ××ª ×”×˜×§×¡×˜ ×”× ×›×•×Ÿ</strong></li>
            </ol>
        </div>

        <div id="status" class="status info">××—×›×” ×œ×‘×“×™×§×”...</div>

        <div class="test-area">
            <strong>ğŸ¯ ×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×”×–×” ×œ×‘×“×™×§×”:</strong><br><br>
            ×–×”×• ×˜×§×¡×˜ ×™×™×¢×•×“×™ ×œ×‘×“×™×§×ª ×”×ª×™×§×•×Ÿ ×©×œ ×”×ª×¤×¨×™×˜ ×”×¦×£. ×›×©×ª×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×”×–×”, 
            ×××•×¨ ×œ×”×•×¤×™×¢ ×ª×¤×¨×™×˜ ×¦×£ ×¢× ×›×¤×ª×•×¨ "ğŸ“„ ×¡×›× ×˜×§×¡×˜ ××¡×•××Ÿ". ×œ×—×™×¦×” ×¢×œ ×”×›×¤×ª×•×¨ 
            ×××•×¨×” ×œ×¤×ª×•×— ××ª ×“×™××œ×•×’ ×”×¡×™×›×•× ××™×“, ×‘×œ×™ ×©×”×ª×¤×¨×™×˜ ×™×™×¡×’×¨ ×•×™×¤×ª×— ××—×“×©. 
            ×–×”×• ×”×‘×“×™×§×” ×”×§×¨×™×˜×™×ª ×œ×•×•×“× ×©×”×ª×™×§×•×Ÿ ×¢×‘×“. ×× ×”×“×™××œ×•×’ × ×¤×ª×— ×‘×”×¦×œ×—×”, 
            ×–×” ××•××¨ ×©×”×‘×¢×™×” × ×¤×ª×¨×”!
        </div>

        <div class="steps">
            <h3>ğŸ” ××” ×œ×¦×¤×•×ª:</h3>
            <div class="status success">âœ… × ×›×•×Ÿ: ×‘×—×™×¨×ª ×˜×§×¡×˜ â†’ ×ª×¤×¨×™×˜ ×¦×£ â†’ ×œ×—×™×¦×” â†’ ×“×™××œ×•×’ × ×¤×ª×—</div>
            <div class="status error">âŒ ×©×’×•×™: ×‘×—×™×¨×ª ×˜×§×¡×˜ â†’ ×ª×¤×¨×™×˜ ×¦×£ â†’ ×œ×—×™×¦×” â†’ ×ª×¤×¨×™×˜ × ×¡×’×¨/× ×¤×ª×— ××—×“×©</div>
        </div>

        <h3>ğŸ“Š ×œ×•×’ ××™×¨×•×¢×™×:</h3>
        <div id="console" class="console">××—×›×” ×œ××™×¨×•×¢×™×...</div>
    </div>

    <script>
        let eventLog = [];
        const maxLogs = 30;

        // Console override to capture logs
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        function addToEventLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${type}: ${message}`);
            if (eventLog.length > maxLogs) {
                eventLog = eventLog.slice(-maxLogs);
            }
            updateConsoleDisplay();
            
            // Also call original console
            originalConsole[type].apply(console, [message]);
        }

        console.log = (...args) => addToEventLog('LOG', args.join(' '));
        console.error = (...args) => addToEventLog('ERROR', args.join(' '));
        console.warn = (...args) => addToEventLog('WARN', args.join(' '));

        function updateConsoleDisplay() {
            document.getElementById('console').textContent = eventLog.join('\n');
            document.getElementById('console').scrollTop = document.getElementById('console').scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
        }

        // Monitor text selection
        let selectionCount = 0;
        document.addEventListener('mouseup', () => {
            setTimeout(() => {
                const selectedText = window.getSelection().toString().trim();
                if (selectedText.length > 10) {
                    selectionCount++;
                    console.log(`ğŸ“ Text selection #${selectionCount}: "${selectedText.substring(0, 40)}..."`);
                    updateStatus(`âœ… ×˜×§×¡×˜ × ×‘×—×¨ (${selectedText.length} ×ª×•×•×™×) - ××—×›×” ×œ×ª×¤×¨×™×˜ ×¦×£...`, 'success');
                    
                    // Check if menu appears
                    setTimeout(() => {
                        const menu = document.getElementById('betterme-floating-menu');
                        if (menu && menu.style.display === 'block') {
                            console.log('âœ… Floating menu appeared after text selection');
                            updateStatus('âœ… ×ª×¤×¨×™×˜ ×¦×£ ××•×¤×™×¢ - ×¢×›×©×™×• ×œ×—×¥ ×¢×œ "×¡×›× ×˜×§×¡×˜ ××¡×•××Ÿ"', 'success');
                        } else {
                            console.log('âŒ Floating menu did not appear');
                            updateStatus('âŒ ×ª×¤×¨×™×˜ ×¦×£ ×œ× ××•×¤×™×¢', 'error');
                        }
                    }, 300);
                }
            }, 100);
        });

        // Monitor clicks on floating menu
        let menuClickCount = 0;
        document.addEventListener('click', (e) => {
            if (e.target.closest('#betterme-floating-menu')) {
                menuClickCount++;
                console.log(`ğŸ”¥ Floating menu click #${menuClickCount} detected`);
                updateStatus('ğŸ”¥ ×–×•×”×ª×” ×œ×—×™×¦×” ×¢×œ ×”×ª×¤×¨×™×˜ - ×‘×•×“×§ ×× × ×¤×ª×— ×“×™××œ×•×’...', 'warning');
                
                setTimeout(() => {
                    const dialog = document.getElementById('betterme-summary-dialog');
                    const overlay = document.getElementById('betterme-summary-overlay');
                    
                    if (dialog && overlay) {
                        console.log('âœ… SUCCESS: Dialog opened after menu click!');
                        updateStatus('ğŸ‰ ××¢×•×œ×”! ×”×“×™××œ×•×’ × ×¤×ª×— ×‘×”×¦×œ×—×” - ×”×ª×™×§×•×Ÿ ×¢×‘×“!', 'success');
                    } else {
                        console.log('âŒ FAIL: Dialog did not open after menu click');
                        updateStatus('âŒ ×“×™××œ×•×’ ×œ× × ×¤×ª×— - ×™×© ×¢×“×™×™×Ÿ ×‘×¢×™×”', 'error');
                    }
                }, 1000);
            }
        }, true);

        // Monitor if menu disappears and reappears (the original problem)
        let menuVisibilityCount = 0;
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    const menu = mutation.target;
                    if (menu.id === 'betterme-floating-menu') {
                        const isVisible = menu.style.display === 'block';
                        menuVisibilityCount++;
                        console.log(`ğŸ‘€ Menu visibility change #${menuVisibilityCount}: ${isVisible ? 'VISIBLE' : 'HIDDEN'}`);
                        
                        if (menuVisibilityCount > 2) {
                            console.log('âš ï¸ Warning: Menu visibility changed multiple times - possible issue');
                            updateStatus('âš ï¸ ×ª×¤×¨×™×˜ ××©× ×” × ×¨××•×ª ××¡×¤×¨ ×¤×¢××™× - ×™×›×•×œ ×œ×”×™×•×ª ×©×™×© ×‘×¢×™×”', 'warning');
                        }
                    }
                }
            });
        });

        // Start observing when menu is created
        setTimeout(() => {
            const menu = document.getElementById('betterme-floating-menu');
            if (menu) {
                observer.observe(menu, { attributes: true, attributeFilter: ['style'] });
                console.log('ğŸ‘€ Started monitoring menu visibility changes');
            }
        }, 2000);

        // Initial status
        setTimeout(() => {
            console.log('ğŸš€ Test page loaded - ready for testing');
            updateStatus('âœ… ×“×£ × ×˜×¢×Ÿ - ×‘×—×¨ ×˜×§×¡×˜ ×›×—×•×œ ×œ××˜×” ×œ×‘×“×™×§×”', 'info');
        }, 1000);
    </script>
</body>
</html>
