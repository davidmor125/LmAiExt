<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בדיקת שמירת בחירת טקסט</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 30px;
            direction: rtl;
            line-height: 1.8;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #182857;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 15px;
        }
        .test-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }
        .test-text {
            background: #fff;
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: text;
            user-select: text;
            transition: all 0.3s ease;
        }
        .test-text:hover {
            border-color: #0056b3;
            box-shadow: 0 2px 10px rgba(0,123,255,0.1);
        }
        .test-text.selected {
            background: #e3f2fd;
            border-color: #2196F3;
            box-shadow: 0 4px 15px rgba(33,150,243,0.2);
        }
        .instructions {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #155724;
        }
        .instructions h3 {
            margin-top: 0;
            color: #0f5132;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        .status {
            margin: 15px 0;
            padding: 12px;
            border-radius: 6px;
            font-weight: 600;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }
        .log {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            height: 150px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .highlight {
            background: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 בדיקת שמירת בחירת טקסט</h1>
        
        <div class="instructions">
            <h3>📋 הוראות הבדיקה:</h3>
            <ol>
                <li><strong>בחר טקסט</strong> מאחד הקטעים למטה</li>
                <li><strong>לחץ על כפתור הסיכום</strong> שיופיע בתפריט הקונטקסט</li>
                <li><strong>בדוק</strong> שהטקסט נשאר מסומן גם אחרי פתיחת חלונית הסיכום</li>
                <li><strong>נסה ללחוץ</strong> בתוך חלונית הסיכום ובדוק שהסימון לא נעלם</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>🎯 טקסט בדיקה מס' 1 - קצר</h3>
            <div class="test-text" id="text1">
                זהו טקסט קצר לבדיקת פונקציית הסיכום. בחר אותי וראה אם הסימון נשמר!
            </div>
        </div>

        <div class="test-section">
            <h3>🎯 טקסט בדיקה מס' 2 - בינוני</h3>
            <div class="test-text" id="text2">
                זהו טקסט ארוך יותר לבדיקת פונקציית הסיכום. הטקסט כולל כמה משפטים כדי לוודא 
                שהמערכת מסוגלת לטפל בטקסט של אורך בינוני. בחר חלק מהטקסט הזה או את כולו 
                ובדוק שהסימון נשמר אחרי פתיחת חלונית הסיכום.
            </div>
        </div>

        <div class="test-section">
            <h3>🎯 טקסט בדיקה מס' 3 - ארוך</h3>
            <div class="test-text" id="text3">
                זהו טקסט ארוך המיועד לבדיקה מקיפה של פונקציית הסיכום. הטקסט מכיל מספר 
                פסקאות ומושגים שונים כדי לבדוק את יכולות המערכת לעבד תוכן מורכב.
                
                הבדיקה כוללת גם וידוא שהטקסט הנבחר נשמר במהלך פעולת הסיכום, כך שהמשתמש 
                יוכל לראות איזה חלק מהטקסט בדיוק הוא בחר לסיכום.
                
                פונקציונליות זו חשובה מאוד לחוויית המשתמש, כיוון שהיא מאפשרת לו להבין 
                בדיוק על איזה תוכן המערכת מבססת את הסיכום שלה. בחר חלק מהטקסט הזה 
                ונסה את הפונקציה!
            </div>
        </div>

        <div class="test-section">
            <h3>🔧 כלי בדיקה ידניים</h3>
            <button class="test-button" id="select-text1">בחר טקסט 1</button>
            <button class="test-button" id="select-text2">בחר טקסט 2</button>
            <button class="test-button" id="select-text3">בחר טקסט 3</button>
            <button class="test-button" id="clear-selection">נקה בחירה</button>
            <button class="test-button" id="check-selection">בדוק בחירה נוכחית</button>
        </div>

        <div class="status info" id="status">
            <strong>סטטוס:</strong> ממתין לבחירת טקסט...
        </div>

        <div class="test-section">
            <h3>📊 לוג בדיקות</h3>
            <div class="log" id="log">מערכת בדיקות אותחלה...\n</div>
            <button class="test-button" onclick="clearLog()">נקה לוג</button>
        </div>
    </div>

    <script>
        // Logging system
        const logElement = document.getElementById('log');
        const statusElement = document.getElementById('status');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString('he-IL');
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        function clearLog() {
            logElement.textContent = 'לוג נוקה...\n';
        }

        // Selection monitoring
        let lastSelection = '';
        
        function checkSelection() {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            
            if (selectedText !== lastSelection) {
                lastSelection = selectedText;
                
                if (selectedText.length > 0) {
                    updateStatus(`נבחר: "${selectedText.substring(0, 50)}${selectedText.length > 50 ? '...' : ''}"`, 'success');
                    log(`✅ טקסט נבחר: ${selectedText.length} תווים - "${selectedText.substring(0, 100)}..."`);
                    
                    // Highlight the selected text container
                    document.querySelectorAll('.test-text').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    const range = selection.getRangeAt(0);
                    const container = range.commonAncestorContainer;
                    const textElement = container.nodeType === Node.TEXT_NODE 
                        ? container.parentElement 
                        : container;
                    
                    if (textElement.classList.contains('test-text')) {
                        textElement.classList.add('selected');
                    }
                } else {
                    updateStatus('אין טקסט נבחר', 'info');
                    log('ℹ️ בחירת טקסט נוקתה');
                    document.querySelectorAll('.test-text').forEach(el => {
                        el.classList.remove('selected');
                    });
                }
            }
        }

        // Monitor selection changes
        document.addEventListener('selectionchange', checkSelection);
        
        // Check selection every 500ms to catch any changes
        setInterval(checkSelection, 500);

        // Manual selection buttons
        document.getElementById('select-text1').addEventListener('click', () => {
            selectText('text1');
        });

        document.getElementById('select-text2').addEventListener('click', () => {
            selectText('text2');
        });

        document.getElementById('select-text3').addEventListener('click', () => {
            selectText('text3');
        });

        document.getElementById('clear-selection').addEventListener('click', () => {
            window.getSelection().removeAllRanges();
            log('🧹 בחירה נוקתה ידנית');
        });

        document.getElementById('check-selection').addEventListener('click', () => {
            checkSelection();
            const selection = window.getSelection();
            log(`🔍 בדיקת בחירה: ${selection.toString().length} תווים נבחרים`);
        });

        function selectText(elementId) {
            const element = document.getElementById(elementId);
            const range = document.createRange();
            range.selectNodeContents(element);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            log(`👆 נבחר טקסט מ-${elementId} באופן ידני`);
        }

        // Monitor clicks on test text elements
        document.querySelectorAll('.test-text').forEach((element, index) => {
            element.addEventListener('mouseup', () => {
                setTimeout(() => {
                    const selection = window.getSelection().toString().trim();
                    if (selection.length > 0) {
                        log(`🖱️ נבחר טקסט בקטע ${index + 1} עם העכבר`);
                    }
                }, 50);
            });
        });

        // Initialize
        log('🚀 מערכת בדיקת שמירת בחירה הופעלה');
        log('📝 בחר טקסט מאחד הקטעים למעלה');
        log('🔍 המערכת תעקוב אחר שינויים בבחירה');
        
        // Check if Better Me extension is available
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            log('✅ תוסף Better Me זוהה - מוכן לבדיקה');
            updateStatus('תוסף Better Me זמין - בחר טקסט לבדיקה', 'success');
        } else {
            log('❌ תוסף Better Me לא זוהה');
            updateStatus('תוסף Better Me לא זמין', 'error');
        }
    </script>
</body>
</html>
