<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בדיקה פשוטה - כפתור דיאלוג</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #2c5282;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin: 10px;
        }
        .test-button:hover {
            background: #1a365d;
        }
        .test-text {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #ffc107;
            font-size: 16px;
            line-height: 1.6;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 בדיקה פשוטה של דיאלוג הסיכום</h1>
        
        <p>דף זה בודק את הפונקציה בצורה הכי פשוטה:</p>
        
        <button class="test-button" onclick="testDialog()">
            🚀 פתח דיאלוג סיכום
        </button>
        
        <button class="test-button" onclick="checkFunctions()">
            🔍 בדוק פונקציות
        </button>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div class="test-text">
            <strong>או בחר את הטקסט הזה:</strong><br>
            זהו טקסט לבדיקה. אם תבחר את הטקסט הזה, אמור להופיע תפריט צף. 
            אם לא, אז יש בעיה בקוד התוסף. הטקסט הזה מספיק ארוך כדי לבדוק 
            את פונקציונליות הסיכום של Better Me.
        </div>
        
        <h3>🎯 מה אמור לקרות:</h3>
        <ol>
            <li>לחיצה על הכפתור אמורה לפתוח דיאלוג מודאלי</li>
            <li>בחירת טקסט אמורה להציג תפריט צף</li>
            <li>לחיצה על "סכם טקסט מסומן" בתפריט אמורה לפתוח דיאלוג</li>
        </ol>
    </div>

    <script>
        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${isError ? 'error' : 'success'}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }

        function testDialog() {
            console.log('🧪 Testing dialog function...');
            
            // Check if the function exists
            if (typeof openSummaryDialog === 'function') {
                console.log('✅ openSummaryDialog found, calling...');
                showStatus('✅ פונקציה נמצאה, פותח דיאלוג...');
                
                const testText = 'זהו טקסט בדיקה ישיר מהכפתור. אם אתה רואה את הטקסט הזה בדיאלוג, זה אומר שהפונקציה עובדת כמו שצריך!';
                
                try {
                    openSummaryDialog(testText);
                    showStatus('✅ דיאלוג נפתח בהצלחה!');
                } catch (error) {
                    console.error('Error calling openSummaryDialog:', error);
                    showStatus('❌ שגיאה בפתיחת הדיאלוג: ' + error.message, true);
                }
            } else if (typeof window.openSummaryDialog === 'function') {
                console.log('✅ window.openSummaryDialog found, calling...');
                showStatus('✅ פונקציה נמצאה ב-window, פותח דיאלוג...');
                
                const testText = 'זהו טקסט בדיקה ישיר מהכפתור (window scope). אם אתה רואה את הטקסט הזה בדיאלוג, זה אומר שהפונקציה עובדת!';
                
                try {
                    window.openSummaryDialog(testText);
                    showStatus('✅ דיאלוג נפתח בהצלחה מ-window!');
                } catch (error) {
                    console.error('Error calling window.openSummaryDialog:', error);
                    showStatus('❌ שגיאה בפתיחת הדיאלוג מ-window: ' + error.message, true);
                }
            } else {
                console.error('❌ openSummaryDialog function not found!');
                showStatus('❌ פונקציית openSummaryDialog לא נמצאה! התוסף לא נטען.', true);
            }
        }

        function checkFunctions() {
            console.log('🔍 Checking extension functions...');
            
            const functions = [
                'openSummaryDialog',
                'handleFloatingMenuSummary',
                'initFloatingMenu',
                'createFloatingMenu',
                'hideFloatingMenu'
            ];
            
            let found = 0;
            let notFound = [];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    console.log(`✅ ${funcName} found`);
                    found++;
                } else {
                    console.log(`❌ ${funcName} NOT found`);
                    notFound.push(funcName);
                }
            });
            
            if (found === functions.length) {
                showStatus(`✅ כל הפונקציות נמצאו (${found}/${functions.length})`);
            } else {
                showStatus(`⚠️ נמצאו ${found}/${functions.length} פונקציות. חסרות: ${notFound.join(', ')}`, found === 0);
            }
            
            // Check if floating menu element exists
            const menu = document.getElementById('betterme-floating-menu');
            if (menu) {
                console.log('✅ Floating menu element found');
            } else {
                console.log('❌ Floating menu element NOT found');
            }
        }

        // Check status on load
        setTimeout(() => {
            console.log('🚀 Page loaded, checking extension...');
            checkFunctions();
        }, 1000);

        // Listen for text selection to test floating menu
        document.addEventListener('mouseup', () => {
            setTimeout(() => {
                const selectedText = window.getSelection().toString().trim();
                if (selectedText.length > 10) {
                    console.log('📝 Text selected:', selectedText.substring(0, 30) + '...');
                    
                    // Check if floating menu appears
                    setTimeout(() => {
                        const menu = document.getElementById('betterme-floating-menu');
                        if (menu && menu.style.display === 'block') {
                            console.log('✅ Floating menu appeared!');
                            showStatus('✅ תפריט צף מופיע - נסה ללחוץ על הכפתור!');
                        } else if (menu) {
                            console.log('⚠️ Floating menu exists but not visible');
                            showStatus('⚠️ תפריט צף קיים אבל לא נראה', true);
                        } else {
                            console.log('❌ Floating menu not found');
                            showStatus('❌ תפריט צף לא נמצא', true);
                        }
                    }, 200);
                }
            }, 100);
        });
    </script>
</body>
</html>
