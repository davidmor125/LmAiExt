<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•× - ×¤×©×•×˜</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #007bff;
            margin-top: 0;
        }
        .sample-text {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            margin: 10px 0;
            user-select: text;
            cursor: text;
        }
        .sample-text.selected {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }
        .status-indicator.active {
            background: #28a745;
            animation: pulse 1.5s infinite;
        }
        .status-indicator.error {
            background: #dc3545;
        }
        .status-indicator.inactive {
            background: #6c757d;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .log-console {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        .clear-logs {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•× - ××‘×—×Ÿ ×¤×©×•×˜</h1>
        <p>×“×£ ×–×” ×××¤×©×¨ ×œ×‘×“×•×§ ×× ×›×¤×ª×•×¨ ×”×¡×™×›×•× ×¢×•×‘×“ ×ª×§×™×Ÿ ×œ××—×¨ ×”×ª×™×§×•× ×™×</p>

        <!-- Test 1: Extension Status -->
        <div class="test-section">
            <h3>ğŸ” ×‘×“×™×§×” 1: ×¡×˜×˜×•×¡ ×”×ª×•×¡×£</h3>
            <p>×‘×•×“×§ ×× ×”×ª×•×¡×£ × ×˜×¢×Ÿ ×•×¤×•×¢×œ:</p>
            <button class="test-button" id="check-extension">×‘×“×•×§ ×¡×˜×˜×•×¡ ×ª×•×¡×£</button>
            <span class="status-indicator inactive" id="extension-status"></span>
            <div class="result" id="extension-result"></div>
        </div>

        <!-- Test 2: Text Selection -->
        <div class="test-section">
            <h3>ğŸ“ ×‘×“×™×§×” 2: ×‘×—×™×¨×ª ×˜×§×¡×˜ ×•×›×¤×ª×•×¨ ×¡×™×›×•×</h3>
            <p>×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×”×‘× ×•×‘×“×•×§ ×× ××•×¤×™×¢ ×›×¤×ª×•×¨ ×”×¡×™×›×•×:</p>
            <div class="sample-text" id="sample-text">
                ×–×”×• ×˜×§×¡×˜ ×œ×“×•×’××” ×œ×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•×. ×”×˜×§×¡×˜ ×›×•×œ×œ ××¡×¤×¨ ××©×¤×˜×™× ×›×“×™ ×œ×•×•×“× ×©×™×© ××¡×¤×™×§ ×ª×•×›×Ÿ ×œ×¡×™×›×•×. 
                ×× ×—× ×• ×‘×•×“×§×™× ×©×”×ª×•×¡×£ ××–×”×” × ×›×•×Ÿ ××ª ×”×˜×§×¡×˜ ×”× ×‘×—×¨ ×•××¦×™×’ ××ª ×›×¤×ª×•×¨ ×”×¡×™×›×•× ×‘×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜ ×”×¦×£. 
                ×œ××—×¨ ×”×œ×—×™×¦×” ×¢×œ ×”×›×¤×ª×•×¨, ×××•×¨×” ×œ×”×•×¤×™×¢ ×—×œ×•× ×™×ª ×”×¡×™×›×•× ×¢× ×”×ª×•×¦××” ××”-AI.
            </div>
            <button class="test-button" id="simulate-selection">×¡××œ×¥ ×‘×—×™×¨×ª ×˜×§×¡×˜</button>
            <span class="status-indicator inactive" id="selection-status"></span>
            <div class="result" id="selection-result"></div>
        </div>

        <!-- Test 3: AI Connection -->
        <div class="test-section">
            <h3>ğŸ¤– ×‘×“×™×§×” 3: ×—×™×‘×•×¨ AI</h3>
            <p>×‘×•×“×§ ×× ×”-AI ××—×•×‘×¨ ×•××’×™×‘:</p>
            <button class="test-button" id="test-ai">×‘×“×•×§ ×—×™×‘×•×¨ AI</button>
            <span class="status-indicator inactive" id="ai-status"></span>
            <div class="result" id="ai-result"></div>
        </div>

        <!-- Test 4: Summary Function -->
        <div class="test-section">
            <h3>ğŸ“„ ×‘×“×™×§×” 4: ×¤×•× ×§×¦×™×™×ª ×”×¡×™×›×•×</h3>
            <p>×‘×“×™×§×” ×™×©×™×¨×” ×©×œ ×¤×•× ×§×¦×™×™×ª ×”×¡×™×›×•×:</p>
            <button class="test-button" id="test-summary">×‘×“×•×§ ×¤×•× ×§×¦×™×™×ª ×¡×™×›×•×</button>
            <span class="status-indicator inactive" id="summary-status"></span>
            <div class="result" id="summary-result"></div>
        </div>

        <!-- Console Log -->
        <div class="test-section">
            <h3>ğŸ”§ ×œ×•×’ ×‘×“×™×§×•×ª</h3>
            <button class="clear-logs" id="clear-logs">× ×§×” ×œ×•×’</button>
            <div class="log-console" id="log-console">××ª×—×•×œ ××¢×¨×›×ª ×”×‘×“×™×§×•×ª...</div>
        </div>
    </div>

    <script>
        // Console logging system
        const logConsole = document.getElementById('log-console');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;

        function addToLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('he-IL');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            logConsole.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logConsole.scrollTop = logConsole.scrollHeight;
        }

        // Override console methods
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToLog(args.join(' '), 'info');
        };

        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };

        // Clear logs
        document.getElementById('clear-logs').addEventListener('click', () => {
            logConsole.textContent = '×œ×•×’ × ×•×§×”...\n';
        });

        // Helper functions
        function setStatus(elementId, status) {
            const element = document.getElementById(elementId);
            element.className = `status-indicator ${status}`;
        }

        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.textContent = message;
            element.style.display = 'block';
        }

        // Test 1: Extension Status
        document.getElementById('check-extension').addEventListener('click', async () => {
            console.log('ğŸ” ×‘×•×“×§ ×¡×˜×˜×•×¡ ×”×ª×•×¡×£...');
            setStatus('extension-status', 'active');
            
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                    console.log('âœ… Chrome extension API ×–××™×Ÿ');
                    console.log('ğŸ“‹ Extension ID:', chrome.runtime.id);
                    
                    // Check if extension is responsive
                    chrome.runtime.sendMessage({action: 'ping'}, (response) => {
                        if (chrome.runtime.lastError) {
                            console.error('âŒ ×©×’×™××” ×‘×ª×§×©×•×¨×ª ×¢× ×”×ª×•×¡×£:', chrome.runtime.lastError.message);
                            setStatus('extension-status', 'error');
                            showResult('extension-result', '×”×ª×•×¡×£ ×œ× ××’×™×‘ - × ×¡×” ×œ×˜×¢×•×Ÿ ××—×“×© ××ª ×”×“×£', false);
                        } else {
                            console.log('âœ… ×”×ª×•×¡×£ ×¤×•×¢×œ ×•××’×™×‘');
                            setStatus('extension-status', 'active');
                            showResult('extension-result', '×”×ª×•×¡×£ ×¤×•×¢×œ ×ª×§×™×Ÿ!', true);
                        }
                    });
                } else {
                    throw new Error('Chrome extension API ×œ× ×–××™×Ÿ');
                }
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘×‘×“×™×§×ª ×”×ª×•×¡×£:', error.message);
                setStatus('extension-status', 'error');
                showResult('extension-result', `×©×’×™××”: ${error.message}`, false);
            }
        });

        // Test 2: Text Selection Simulation
        document.getElementById('simulate-selection').addEventListener('click', () => {
            console.log('ğŸ“ ××“××” ×‘×—×™×¨×ª ×˜×§×¡×˜...');
            setStatus('selection-status', 'active');
            
            const textElement = document.getElementById('sample-text');
            textElement.classList.add('selected');
            
            // Simulate text selection
            const range = document.createRange();
            range.selectNodeContents(textElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            console.log('âœ… ×˜×§×¡×˜ × ×‘×—×¨:', selection.toString().substring(0, 50) + '...');
            
            // Check if Better Me extension is active and can detect selection
            setTimeout(() => {
                if (document.getElementById('betterme-bubble') || document.getElementById('betterme-context-menu')) {
                    console.log('âœ… ×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜ ×©×œ Better Me ×–×•×”×”');
                    setStatus('selection-status', 'active');
                    showResult('selection-result', '×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜ ×¤×¢×™×œ - ×—×¤×© ××ª ×›×¤×ª×•×¨ ×”×¡×™×›×•×', true);
                } else {
                    console.log('âš ï¸ ×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜ ×œ× ×–×•×”×” - × ×¡×” ×œ×”×¤×¢×™×œ ××ª ×”×ª×•×¡×£');
                    setStatus('selection-status', 'error');
                    showResult('selection-result', '×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜ ×œ× × ××¦× - ×”×¤×¢×œ ××ª ×”×ª×•×¡×£ ××• ×‘×—×¨ ×˜×§×¡×˜ ×™×“× ×™×ª', false);
                }
            }, 1000);
        });

        // Test 3: AI Connection
        document.getElementById('test-ai').addEventListener('click', async () => {
            console.log('ğŸ¤– ×‘×•×“×§ ×—×™×‘×•×¨ AI...');
            setStatus('ai-status', 'active');
            
            try {
                // Send test message to background script
                chrome.runtime.sendMessage({
                    action: 'summarize',
                    content: '×˜×§×¡×˜ ×œ×‘×“×™×§×”',
                    type: 'test'
                });
                
                console.log('ğŸ“¤ ×”×•×“×¢×ª ×‘×“×™×§×” × ×©×œ×—×” ×œ-background script');
                
                // Listen for response
                const messageListener = (message) => {
                    console.log('ğŸ“¥ ×ª×’×•×‘×” ×-background script:', message);
                    
                    if (message.action === 'displayResult') {
                        console.log('âœ… AI ××—×•×‘×¨ ×•×¤×•×¢×œ');
                        setStatus('ai-status', 'active');
                        showResult('ai-result', 'AI ××—×•×‘×¨ ×•××’×™×‘ ×ª×§×™×Ÿ!', true);
                        chrome.runtime.onMessage.removeListener(messageListener);
                    } else if (message.action === 'displayError') {
                        console.error('âŒ ×©×’×™××ª AI:', message.error);
                        setStatus('ai-status', 'error');
                        showResult('ai-result', `×©×’×™××ª AI: ${message.error}`, false);
                        chrome.runtime.onMessage.removeListener(messageListener);
                    }
                };
                
                chrome.runtime.onMessage.addListener(messageListener);
                
                // Timeout after 10 seconds
                setTimeout(() => {
                    chrome.runtime.onMessage.removeListener(messageListener);
                    console.error('âŒ ××™×Ÿ ×ª×’×•×‘×” ×-AI ×œ××—×¨ 10 ×©× ×™×•×ª');
                    setStatus('ai-status', 'error');
                    showResult('ai-result', '××™×Ÿ ×ª×’×•×‘×” ×-AI - ×‘×“×•×§ ×”×’×“×¨×•×ª API', false);
                }, 10000);
                
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘×‘×“×™×§×ª AI:', error.message);
                setStatus('ai-status', 'error');
                showResult('ai-result', `×©×’×™××”: ${error.message}`, false);
            }
        });

        // Test 4: Summary Function Test
        document.getElementById('test-summary').addEventListener('click', () => {
            console.log('ğŸ“„ ×‘×•×“×§ ×¤×•× ×§×¦×™×™×ª ×¡×™×›×•×...');
            setStatus('summary-status', 'active');
            
            const testText = document.getElementById('sample-text').textContent;
            
            try {
                // Send summarize request
                chrome.runtime.sendMessage({
                    action: 'summarize',
                    content: testText,
                    type: 'selection'
                });
                
                console.log('ğŸ“¤ ×‘×§×©×ª ×¡×™×›×•× × ×©×œ×—×”');
                
                // Listen for summary result
                const summaryListener = (message) => {
                    console.log('ğŸ“¥ ×ª×’×•×‘×ª ×¡×™×›×•×:', message);
                    
                    if (message.action === 'displayResult' && message.type === 'summarize') {
                        console.log('âœ… ×¡×™×›×•× ×”×•×©×œ× ×‘×”×¦×œ×—×”');
                        setStatus('summary-status', 'active');
                        showResult('summary-result', `×¡×™×›×•× ×”×ª×§×‘×œ: ${message.result.substring(0, 100)}...`, true);
                        chrome.runtime.onMessage.removeListener(summaryListener);
                    } else if (message.action === 'displayError') {
                        console.error('âŒ ×©×’×™××” ×‘×¡×™×›×•×:', message.error);
                        setStatus('summary-status', 'error');
                        showResult('summary-result', `×©×’×™××ª ×¡×™×›×•×: ${message.error}`, false);
                        chrome.runtime.onMessage.removeListener(summaryListener);
                    }
                };
                
                chrome.runtime.onMessage.addListener(summaryListener);
                
                // Timeout after 15 seconds
                setTimeout(() => {
                    chrome.runtime.onMessage.removeListener(summaryListener);
                    console.error('âŒ ×œ× ×”×ª×§×‘×œ ×¡×™×›×•× ×œ××—×¨ 15 ×©× ×™×•×ª');
                    setStatus('summary-status', 'error');
                    showResult('summary-result', '×œ× ×”×ª×§×‘×œ ×¡×™×›×•× - ×‘×“×•×§ ×—×™×‘×•×¨ AI', false);
                }, 15000);
                
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘×¤×•× ×§×¦×™×™×ª ×¡×™×›×•×:', error.message);
                setStatus('summary-status', 'error');
                showResult('summary-result', `×©×’×™××”: ${error.message}`, false);
            }
        });

        // Initialize
        console.log('ğŸš€ ××¢×¨×›×ª ×‘×“×™×§×•×ª ×”×•×¤×¢×œ×”');
        console.log('ğŸ“‹ ×”×•×¨××•×ª: ×”×¨×¥ ×›×œ ×‘×“×™×§×” ×‘×¡×“×¨ ×œ××‘×—×•×Ÿ ×‘×¢×™×•×ª');
        
    </script>
</body>
</html>
