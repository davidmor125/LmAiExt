<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×›×¤×ª×•×¨ ×¡×™×›×•× - ×¦×¢×“ ××—×¨ ×¦×¢×“</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .step {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            position: relative;
        }
        .step.success {
            border-color: #28a745;
            background: #d4edda;
        }
        .step.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .step.active {
            border-color: #007bff;
            background: #e3f2fd;
        }
        .step-number {
            position: absolute;
            top: -10px;
            right: 20px;
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .step.success .step-number {
            background: #28a745;
        }
        .step.error .step-number {
            background: #dc3545;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
        }
        .button:hover {
            background: #0056b3;
        }
        .button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .text-area {
            background: #f8f9fa;
            padding: 15px;
            border: 2px dashed #dee2e6;
            border-radius: 5px;
            margin: 10px 0;
            user-select: text;
            cursor: text;
            min-height: 60px;
        }
        .text-area.selected {
            background: #fff3cd;
            border-color: #ffc107;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        .status.waiting {
            background: #ffc107;
            color: #856404;
        }
        .status.success {
            background: #28a745;
            color: white;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        h1 {
            color: #007bff;
            text-align: center;
        }
        h3 {
            margin-top: 0;
            color: #495057;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•× - ×¦×¢×“ ××—×¨ ×¦×¢×“</h1>
        
        <div class="warning">
            <strong>âš ï¸ ×”×•×¨××•×ª ×—×©×•×‘×•×ª:</strong><br>
            1. ×•×•×“× ×©×”×ª×•×¡×£ Better Me ××•×ª×§×Ÿ ×•×¤×¢×™×œ<br>
            2. ×”×’×“×¨ ××ª ×”-AI API (LMStudio/Ollama) ×‘×”×’×“×¨×•×ª ×”×ª×•×¡×£<br>
            3. ×”×¨×¥ ××ª ×”×‘×“×™×§×•×ª ×œ×¤×™ ×”×¡×“×¨
        </div>

        <!-- Step 1 -->
        <div class="step" id="step1">
            <div class="step-number">1</div>
            <h3>×‘×“×™×§×ª ×”×ª×•×¡×£</h3>
            <p>×‘×•×“×§ ×× ×”×ª×•×¡×£ Better Me × ×˜×¢×Ÿ ×•×¤×•×¢×œ ×ª×§×™×Ÿ</p>
            <button class="button" id="btn-step1">×‘×“×•×§ ×”×ª×•×¡×£</button>
            <span class="status waiting" id="status1">×××ª×™×Ÿ</span>
            <div class="result-box" id="result1" style="display: none;"></div>
        </div>

        <!-- Step 2 -->
        <div class="step" id="step2">
            <div class="step-number">2</div>
            <h3>×‘×“×™×§×ª ×”×’×“×¨×•×ª AI</h3>
            <p>×‘×•×“×§ ×× ×”×’×“×¨×•×ª ×”-AI ××•×’×“×¨×•×ª × ×›×•×Ÿ</p>
            <button class="button" id="btn-step2" disabled>×‘×“×•×§ ×”×’×“×¨×•×ª</button>
            <span class="status waiting" id="status2">×××ª×™×Ÿ</span>
            <div class="result-box" id="result2" style="display: none;"></div>
        </div>

        <!-- Step 3 -->
        <div class="step" id="step3">
            <div class="step-number">3</div>
            <h3>×‘×“×™×§×ª ×—×™×‘×•×¨ AI</h3>
            <p>×‘×•×“×§ ×× ×™×© ×—×™×‘×•×¨ ×¤×¢×™×œ ×œ×©×¨×ª ×”-AI</p>
            <button class="button" id="btn-step3" disabled>×‘×“×•×§ ×—×™×‘×•×¨</button>
            <span class="status waiting" id="status3">×××ª×™×Ÿ</span>
            <div class="result-box" id="result3" style="display: none;"></div>
        </div>

        <!-- Step 4 -->
        <div class="step" id="step4">
            <div class="step-number">4</div>
            <h3>×”×¤×¢×œ×ª ×”×ª×•×¡×£</h3>
            <p>××¤×¢×™×œ ××ª ×”×ª×•×¡×£ ×•××¦×™×’ ××ª ×”×××©×§</p>
            <button class="button" id="btn-step4" disabled>×”×¤×¢×œ ×ª×•×¡×£</button>
            <span class="status waiting" id="status4">×××ª×™×Ÿ</span>
            <div class="result-box" id="result4" style="display: none;"></div>
        </div>

        <!-- Step 5 -->
        <div class="step" id="step5">
            <div class="step-number">5</div>
            <h3>×‘×—×™×¨×ª ×˜×§×¡×˜</h3>
            <p>×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×”×‘× ×•×‘×“×•×§ ×× ××•×¤×™×¢ ×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜:</p>
            <div class="text-area" id="sample-text">
                ×–×”×• ×˜×§×¡×˜ ×œ×“×•×’××” ×œ×‘×“×™×§×ª ×¤×•× ×§×¦×™×™×ª ×”×¡×™×›×•×. ×”×˜×§×¡×˜ ×›×•×œ×œ ××¡×¤×¨ ××©×¤×˜×™× ×•×¤×¡×§××•×ª 
                ×›×“×™ ×œ×•×•×“× ×©×™×© ××¡×¤×™×§ ×ª×•×›×Ÿ ×œ×¡×™×›×•× ××§×™×£. ×× ×—× ×• ×‘×•×“×§×™× ×©×”×ª×•×¡×£ Better Me 
                ××–×”×” × ×›×•×Ÿ ××ª ×”×˜×§×¡×˜ ×”× ×‘×—×¨ ×•××¦×™×’ ××ª ×›×¤×ª×•×¨ ×”×¡×™×›×•× ×‘×ª×¤×¨×™×˜ ×”×§×•× ×˜×§×¡×˜ ×”×¦×£. 
                ×œ××—×¨ ×”×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ ×”×¡×™×›×•×, ×××•×¨×” ×œ×”×•×¤×™×¢ ×—×œ×•× ×™×ª ×”×¡×™×›×•× ×¢× ×”×ª×•×¦××” ××”××•×“×œ AI.
            </div>
            <button class="button" id="btn-step5" disabled>×¡××œ×¥ ×‘×—×™×¨×”</button>
            <span class="status waiting" id="status5">×××ª×™×Ÿ</span>
            <div class="result-box" id="result5" style="display: none;"></div>
        </div>

        <!-- Step 6 -->
        <div class="step" id="step6">
            <div class="step-number">6</div>
            <h3>×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•×</h3>
            <p>×‘×•×“×§ ×™×©×™×¨×•×ª ××ª ×¤×•× ×§×¦×™×™×ª ×”×¡×™×›×•×</p>
            <button class="button" id="btn-step6" disabled>×‘×“×•×§ ×¡×™×›×•×</button>
            <span class="status waiting" id="status6">×××ª×™×Ÿ</span>
            <div class="result-box" id="result6" style="display: none;"></div>
        </div>

    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let extensionReady = false;
        let settingsValid = false;
        let aiConnected = false;
        let extensionActive = false;

        // Helper functions
        function setStepStatus(step, status, message) {
            const stepEl = document.getElementById(`step${step}`);
            const statusEl = document.getElementById(`status${step}`);
            const resultEl = document.getElementById(`result${step}`);
            
            stepEl.className = `step ${status}`;
            statusEl.className = `status ${status}`;
            statusEl.textContent = status === 'success' ? '×”×•×©×œ×' : status === 'error' ? '×©×’×™××”' : '×××ª×™×Ÿ';
            
            if (message) {
                resultEl.textContent = message;
                resultEl.style.display = 'block';
            }
            
            // Enable next step if current step succeeded
            if (status === 'success' && step < 6) {
                document.getElementById(`btn-step${step + 1}`).disabled = false;
            }
        }

        function log(step, message) {
            console.log(`Step ${step}: ${message}`);
            const resultEl = document.getElementById(`result${step}`);
            resultEl.textContent += `[${new Date().toLocaleTimeString()}] ${message}\n`;
            resultEl.style.display = 'block';
            resultEl.scrollTop = resultEl.scrollHeight;
        }

        // Step 1: Check Extension
        document.getElementById('btn-step1').addEventListener('click', async () => {
            setStepStatus(1, 'active', '');
            log(1, '×‘×•×“×§ ×× ×”×ª×•×¡×£ Better Me ×–××™×Ÿ...');
            
            try {
                if (typeof chrome === 'undefined' || !chrome.runtime || !chrome.runtime.id) {
                    throw new Error('Chrome Extension API ×œ× ×–××™×Ÿ');
                }
                
                log(1, 'Chrome Extension API ×–××™×Ÿ âœ“');
                log(1, `Extension ID: ${chrome.runtime.id}`);
                
                // Test communication with background script
                chrome.runtime.sendMessage({action: 'ping'}, (response) => {
                    if (chrome.runtime.lastError) {
                        log(1, `×©×’×™××” ×‘×ª×§×©×•×¨×ª: ${chrome.runtime.lastError.message}`);
                        setStepStatus(1, 'error', '×”×ª×•×¡×£ ×œ× ××’×™×‘');
                    } else {
                        log(1, '×”×ª×•×¡×£ ××’×™×‘ ×œ×‘×§×©×•×ª âœ“');
                        extensionReady = true;
                        setStepStatus(1, 'success', '×”×ª×•×¡×£ ×¤×•×¢×œ ×ª×§×™×Ÿ');
                    }
                });
                
            } catch (error) {
                log(1, `×©×’×™××”: ${error.message}`);
                setStepStatus(1, 'error', error.message);
            }
        });

        // Step 2: Check Settings
        document.getElementById('btn-step2').addEventListener('click', async () => {
            setStepStatus(2, 'active', '');
            log(2, '×‘×•×“×§ ×”×’×“×¨×•×ª AI...');
            
            try {
                chrome.storage.sync.get(['apiUrl', 'modelName', 'apiType'], (settings) => {
                    log(2, `×”×’×“×¨×•×ª × ×•×›×—×™×•×ª:`);
                    log(2, `API URL: ${settings.apiUrl || '×œ× ××•×’×“×¨'}`);
                    log(2, `Model: ${settings.modelName || '×œ× ××•×’×“×¨'}`);
                    log(2, `Type: ${settings.apiType || '×œ× ××•×’×“×¨'}`);
                    
                    if (settings.apiUrl && settings.modelName) {
                        log(2, '×”×’×“×¨×•×ª AI ××•×’×“×¨×•×ª âœ“');
                        settingsValid = true;
                        setStepStatus(2, 'success', '×”×’×“×¨×•×ª ×ª×§×™× ×•×ª');
                    } else {
                        log(2, '×”×’×“×¨×•×ª AI ×—×¡×¨×•×ª ××• ×©×’×•×™×•×ª');
                        setStepStatus(2, 'error', '×”×’×“×¨×•×ª AI ×œ× ××œ××•×ª');
                    }
                });
                
            } catch (error) {
                log(2, `×©×’×™××”: ${error.message}`);
                setStepStatus(2, 'error', error.message);
            }
        });

        // Step 3: Test AI Connection
        document.getElementById('btn-step3').addEventListener('click', async () => {
            setStepStatus(3, 'active', '');
            log(3, '×‘×•×“×§ ×—×™×‘×•×¨ AI...');
            
            try {
                chrome.storage.sync.get(['apiUrl', 'apiType'], async (settings) => {
                    const apiUrl = settings.apiUrl || 'http://localhost:1234/v1/chat/completions';
                    const apiType = settings.apiType || 'lmstudio';
                    
                    log(3, `×× ×¡×” ×œ×”×ª×—×‘×¨ ×œ-${apiType} ×¢×œ ${apiUrl}`);
                    
                    try {
                        const response = await fetch(apiUrl.replace('/chat/completions', '/models'), {
                            method: 'GET',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        
                        if (response.ok) {
                            log(3, `×—×™×‘×•×¨ ×œ-${apiType} ×”×¦×œ×™×— âœ“`);
                            aiConnected = true;
                            setStepStatus(3, 'success', 'AI ××—×•×‘×¨');
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (fetchError) {
                        log(3, `×©×’×™××ª ×—×™×‘×•×¨: ${fetchError.message}`);
                        log(3, `×•×•×“× ×©-${apiType} ×¤×•×¢×œ ×¢×œ ×”×›×ª×•×‘×ª ×”× ×›×•× ×”`);
                        setStepStatus(3, 'error', '××™×Ÿ ×—×™×‘×•×¨ AI');
                    }
                });
                
            } catch (error) {
                log(3, `×©×’×™××”: ${error.message}`);
                setStepStatus(3, 'error', error.message);
            }
        });

        // Step 4: Activate Extension
        document.getElementById('btn-step4').addEventListener('click', () => {
            setStepStatus(4, 'active', '');
            log(4, '××¤×¢×™×œ ××ª ×”×ª×•×¡×£...');
            
            try {
                // Try to trigger extension activation
                chrome.runtime.sendMessage({action: 'activate'}, (response) => {
                    if (chrome.runtime.lastError) {
                        log(4, `×©×’×™××” ×‘×”×¤×¢×œ×”: ${chrome.runtime.lastError.message}`);
                        setStepStatus(4, 'error', '×©×’×™××” ×‘×”×¤×¢×œ×ª ×”×ª×•×¡×£');
                    } else {
                        log(4, '×”×ª×•×¡×£ ×”×•×¤×¢×œ ×‘×”×¦×œ×—×” âœ“');
                        
                        // Check if Better Me interface is visible
                        setTimeout(() => {
                            if (document.getElementById('betterme-bubble') || 
                                document.getElementById('betterme-overlay')) {
                                log(4, '×××©×§ Better Me ×¤×¢×™×œ âœ“');
                                extensionActive = true;
                                setStepStatus(4, 'success', '×”×ª×•×¡×£ ×¤×¢×™×œ');
                            } else {
                                log(4, '×××©×§ Better Me ×œ× × ××¦× - × ×¡×” ×œ×œ×—×•×¥ ×¢×œ ××™×™×§×•×Ÿ ×”×ª×•×¡×£');
                                setStepStatus(4, 'error', '×××©×§ ×œ× ×¤×¢×™×œ');
                            }
                        }, 2000);
                    }
                });
                
            } catch (error) {
                log(4, `×©×’×™××”: ${error.message}`);
                setStepStatus(4, 'error', error.message);
            }
        });

        // Step 5: Text Selection
        document.getElementById('btn-step5').addEventListener('click', () => {
            setStepStatus(5, 'active', '');
            log(5, '××“××” ×‘×—×™×¨×ª ×˜×§×¡×˜...');
            
            const textEl = document.getElementById('sample-text');
            textEl.classList.add('selected');
            
            // Select the text
            const range = document.createRange();
            range.selectNodeContents(textEl);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            log(5, `×˜×§×¡×˜ × ×‘×—×¨: ${selection.toString().substring(0, 50)}...`);
            
            // Check for context menu
            setTimeout(() => {
                const contextMenu = document.querySelector('[id*="context"]') || 
                                 document.querySelector('[class*="context"]');
                
                if (contextMenu) {
                    log(5, '×ª×¤×¨×™×˜ ×§×•× ×˜×§×¡×˜ ×–×•×”×” âœ“');
                    setStepStatus(5, 'success', '×ª×¤×¨×™×˜ ×§×•× ×˜×§×¡×˜ ×¤×¢×™×œ');
                } else {
                    log(5, '×ª×¤×¨×™×˜ ×§×•× ×˜×§×¡×˜ ×œ× × ××¦× - ×‘×—×¨ ×˜×§×¡×˜ ×™×“× ×™×ª');
                    setStepStatus(5, 'error', '××™×Ÿ ×ª×¤×¨×™×˜ ×§×•× ×˜×§×¡×˜');
                }
            }, 1500);
        });

        // Step 6: Test Summary Function
        document.getElementById('btn-step6').addEventListener('click', () => {
            setStepStatus(6, 'active', '');
            log(6, '×‘×•×“×§ ×¤×•× ×§×¦×™×™×ª ×¡×™×›×•×...');
            
            const testText = document.getElementById('sample-text').textContent;
            
            try {
                // Send summary request
                chrome.runtime.sendMessage({
                    action: 'summarize',
                    content: testText,
                    type: 'selection'
                });
                
                log(6, '×‘×§×©×ª ×¡×™×›×•× × ×©×œ×—×” âœ“');
                
                // Listen for response
                const responseListener = (message) => {
                    log(6, `×ª×’×•×‘×” ×”×ª×§×‘×œ×”: ${JSON.stringify(message)}`);
                    
                    if (message.action === 'displayResult' && message.type === 'summarize') {
                        log(6, '×¡×™×›×•× ×”×•×©×œ× ×‘×”×¦×œ×—×” âœ“');
                        log(6, `×ª×•×¦××”: ${message.result.substring(0, 100)}...`);
                        setStepStatus(6, 'success', '×¡×™×›×•× ×¤×•×¢×œ ×ª×§×™×Ÿ!');
                        chrome.runtime.onMessage.removeListener(responseListener);
                    } else if (message.action === 'displayError') {
                        log(6, `×©×’×™××ª ×¡×™×›×•×: ${message.error}`);
                        setStepStatus(6, 'error', `×©×’×™××”: ${message.error}`);
                        chrome.runtime.onMessage.removeListener(responseListener);
                    }
                };
                
                chrome.runtime.onMessage.addListener(responseListener);
                
                // Timeout after 15 seconds
                setTimeout(() => {
                    chrome.runtime.onMessage.removeListener(responseListener);
                    log(6, '××™×Ÿ ×ª×’×•×‘×” ×œ××—×¨ 15 ×©× ×™×•×ª');
                    setStepStatus(6, 'error', '×ª× ×–××Ÿ ×”×‘×“×™×§×”');
                }, 15000);
                
            } catch (error) {
                log(6, `×©×’×™××”: ${error.message}`);
                setStepStatus(6, 'error', error.message);
            }
        });

        // Initialize
        console.log('ğŸš€ ××¢×¨×›×ª ×‘×“×™×§×•×ª ××•×ª×—×œ×”');
        console.log('ğŸ“‹ ×”×¨×¥ ××ª ×”×‘×“×™×§×•×ª ×œ×¤×™ ×”×¡×“×¨ ×”××¡×¤×¨×™');
    </script>
</body>
</html>
