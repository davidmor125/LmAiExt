<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×™×‘××’ ×‘×¢×™×™×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•×</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .warning { border-color: #ffc107; background: #fff3cd; }
        .test-text {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #2196f3;
            font-size: 16px;
            line-height: 1.8;
            user-select: text;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            direction: ltr;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×“×™×‘××’ ×‘×¢×™×™×ª ×›×¤×ª×•×¨ ×”×¡×™×›×•×</h1>
        <p>×“×£ ×–×” ×™×¢×–×•×¨ ×œ× ×• ×œ×–×”×•×ª ×‘×“×™×•×§ ××™×¤×” ×”×‘×¢×™×”</p>

        <div id="step1" class="step">
            <h3>×©×œ×‘ 1: ×‘×“×™×§×ª ×˜×¢×™× ×ª ×”×ª×•×¡×£</h3>
            <p id="extension-status">×‘×•×“×§...</p>
            <button onclick="checkExtension()">×‘×“×•×§ ×©×•×‘</button>
        </div>

        <div id="step2" class="step">
            <h3>×©×œ×‘ 2: ×‘×“×™×§×ª ×§×™×•× ×¤×•× ×§×¦×™×•×ª</h3>
            <p id="functions-status">×‘×•×“×§...</p>
            <button onclick="checkFunctions()">×‘×“×•×§ ×¤×•× ×§×¦×™×•×ª</button>
        </div>

        <div id="step3" class="step">
            <h3>×©×œ×‘ 3: ×‘×“×™×§×ª ××œ×× ×˜ ×”×ª×¤×¨×™×˜ ×”×¦×£</h3>
            <p id="menu-status">×‘×•×“×§...</p>
            <button onclick="checkMenu()">×‘×“×•×§ ×ª×¤×¨×™×˜</button>
        </div>

        <div id="step4" class="step">
            <h3>×©×œ×‘ 4: ×‘×“×™×§×ª ×¤×•× ×§×¦×™×™×ª ×”×“×™××œ×•×’</h3>
            <p id="dialog-status">×‘×•×“×§...</p>
            <button onclick="testDialog()">×‘×“×•×§ ×“×™××œ×•×’</button>
        </div>

        <div class="step">
            <h3>×©×œ×‘ 5: ×‘×“×™×§×ª ×‘×—×™×¨×ª ×˜×§×¡×˜</h3>
            <p>×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×œ××˜×” ×•×‘×“×•×§ ××” ×§×•×¨×”:</p>
            <div class="test-text">
                ×–×”×• ×˜×§×¡×˜ ×œ×‘×“×™×§×” ×©×œ ×ª×¤×¨×™×˜ ×”×¦×£. ×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×”×–×” ×•×‘×“×•×§ ×× ××•×¤×™×¢ ×ª×¤×¨×™×˜ ×¢× ×›×¤×ª×•×¨ "×¡×›× ×˜×§×¡×˜ ××¡×•××Ÿ". ×× ×”×ª×¤×¨×™×˜ ××•×¤×™×¢, ×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×•×‘×“×•×§ ×× × ×¤×ª×— ×“×™××œ×•×’. ×–×” ×˜×§×¡×˜ ××¨×•×š ××¡×¤×™×§ ×›×“×™ ×œ×‘×“×•×§ ××ª ×›×œ ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª.
            </div>
            <p id="selection-status">×”××ª×Ÿ ×œ×‘×—×™×¨×ª ×˜×§×¡×˜...</p>
        </div>

        <div class="step">
            <h3>ğŸ“Š ×œ×•×’ ×§×•× ×¡×•×œ:</h3>
            <div id="console" class="console-output">××—×›×” ×œ×œ×•×’×™×...</div>
            <button onclick="clearConsole()">× ×§×” ×œ×•×’</button>
        </div>
    </div>

    <script>
        let logs = [];

        // Override console to capture logs
        const originalConsole = window.console;
        window.console = {
            ...originalConsole,
            log: function(...args) {
                originalConsole.log.apply(console, args);
                addLog('LOG', args.join(' '));
            },
            error: function(...args) {
                originalConsole.error.apply(console, args);
                addLog('ERROR', args.join(' '));
            },
            warn: function(...args) {
                originalConsole.warn.apply(console, args);
                addLog('WARN', args.join(' '));
            }
        };

        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${type}: ${message}`);
            if (logs.length > 50) logs = logs.slice(-50);
            updateConsole();
        }

        function updateConsole() {
            document.getElementById('console').textContent = logs.join('\n');
            document.getElementById('console').scrollTop = document.getElementById('console').scrollHeight;
        }

        function clearConsole() {
            logs = [];
            updateConsole();
            console.log('Console cleared');
        }

        function updateStep(stepId, className, message) {
            const step = document.getElementById(stepId);
            step.className = `step ${className}`;
            step.querySelector('p').textContent = message;
        }

        function checkExtension() {
            console.log('ğŸ” Checking if Chrome extension is loaded...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                updateStep('step1', 'success', 'âœ… ×ª×•×¡×£ Chrome × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
                console.log('âœ… Chrome extension API available');
                return true;
            } else {
                updateStep('step1', 'error', 'âŒ ×ª×•×¡×£ Chrome ×œ× × ×˜×¢×Ÿ ××• ×œ× ×¤×¢×™×œ');
                console.error('âŒ Chrome extension API not available');
                return false;
            }
        }

        function checkFunctions() {
            console.log('ğŸ” Checking extension functions...');
            
            const requiredFunctions = [
                'openSummaryDialog',
                'handleFloatingMenuSummary', 
                'initFloatingMenu',
                'createFloatingMenu'
            ];

            let found = 0;
            let missing = [];

            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    console.log(`âœ… Function ${funcName} found`);
                    found++;
                } else {
                    console.error(`âŒ Function ${funcName} NOT found`);
                    missing.push(funcName);
                }
            });

            if (found === requiredFunctions.length) {
                updateStep('step2', 'success', `âœ… ×›×œ ${found} ×”×¤×•× ×§×¦×™×•×ª × ××¦××•`);
                return true;
            } else {
                updateStep('step2', 'error', `âŒ ×—×¡×¨×•×ª ${missing.length} ×¤×•× ×§×¦×™×•×ª: ${missing.join(', ')}`);
                return false;
            }
        }

        function checkMenu() {
            console.log('ğŸ” Checking floating menu element...');
            
            const menu = document.getElementById('betterme-floating-menu');
            if (menu) {
                console.log('âœ… Floating menu element found');
                console.log('Menu display:', menu.style.display);
                console.log('Menu position:', menu.style.position);
                console.log('Menu z-index:', menu.style.zIndex);
                
                // Check if menu has button
                const button = menu.querySelector('button');
                if (button) {
                    console.log('âœ… Menu button found:', button.textContent);
                    updateStep('step3', 'success', 'âœ… ×ª×¤×¨×™×˜ ×¦×£ ×•××ª ×”×›×¤×ª×•×¨ × ××¦××•');
                    return true;
                } else {
                    console.error('âŒ Menu button not found');
                    updateStep('step3', 'warning', 'âš ï¸ ×ª×¤×¨×™×˜ ×¦×£ × ××¦× ××‘×œ ×›×¤×ª×•×¨ ×—×¡×¨');
                    return false;
                }
            } else {
                console.error('âŒ Floating menu element not found');
                updateStep('step3', 'error', 'âŒ ××œ×× ×˜ ×”×ª×¤×¨×™×˜ ×”×¦×£ ×œ× × ××¦×');
                return false;
            }
        }

        function testDialog() {
            console.log('ğŸ§ª Testing dialog function directly...');
            
            if (typeof window.openSummaryDialog === 'function') {
                console.log('âœ… openSummaryDialog function found');
                try {
                    const testText = '×–×”×• ×˜×§×¡×˜ ×‘×“×™×§×” ×™×©×™×¨ ××”×›×¤×ª×•×¨ ×œ×‘×“×™×§×ª ×”×“×™××œ×•×’';
                    console.log('ğŸš€ Calling openSummaryDialog with test text...');
                    window.openSummaryDialog(testText);
                    
                    // Check if dialog was created
                    setTimeout(() => {
                        const dialog = document.getElementById('betterme-summary-dialog');
                        const overlay = document.getElementById('betterme-summary-overlay');
                        
                        if (dialog && overlay) {
                            console.log('âœ… Dialog and overlay created successfully');
                            updateStep('step4', 'success', 'âœ… ×“×™××œ×•×’ × ×•×¦×¨ ×‘×”×¦×œ×—×”');
                        } else {
                            console.error('âŒ Dialog or overlay not created');
                            updateStep('step4', 'error', 'âŒ ×“×™××œ×•×’ ×œ× × ×•×¦×¨');
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('âŒ Error calling openSummaryDialog:', error);
                    updateStep('step4', 'error', 'âŒ ×©×’×™××” ×‘×§×¨×™××” ×œ×¤×•× ×§×¦×™×”: ' + error.message);
                }
            } else {
                console.error('âŒ openSummaryDialog function not found');
                updateStep('step4', 'error', 'âŒ ×¤×•× ×§×¦×™×™×ª openSummaryDialog ×œ× × ××¦××”');
            }
        }

        // Monitor text selection
        document.addEventListener('mouseup', () => {
            setTimeout(() => {
                const selectedText = window.getSelection().toString().trim();
                if (selectedText.length > 10) {
                    console.log('ğŸ“ Text selected:', selectedText.substring(0, 50) + '...');
                    document.getElementById('selection-status').textContent = 
                        `âœ… × ×‘×—×¨ ×˜×§×¡×˜ ×‘××•×¨×š ${selectedText.length} ×ª×•×•×™×`;
                    
                    // Check if floating menu appears
                    setTimeout(() => {
                        checkMenuAfterSelection();
                    }, 300);
                } else {
                    document.getElementById('selection-status').textContent = '×”××ª×Ÿ ×œ×‘×—×™×¨×ª ×˜×§×¡×˜...';
                }
            }, 100);
        });

        function checkMenuAfterSelection() {
            const menu = document.getElementById('betterme-floating-menu');
            if (menu) {
                if (menu.style.display === 'block') {
                    console.log('âœ… Floating menu appeared after text selection');
                    document.getElementById('selection-status').textContent += ' | âœ… ×ª×¤×¨×™×˜ ×¦×£ ××•×¤×™×¢';
                    
                    // Monitor clicks on the menu
                    monitorMenuClicks();
                } else {
                    console.log('âš ï¸ Floating menu exists but not visible');
                    document.getElementById('selection-status').textContent += ' | âš ï¸ ×ª×¤×¨×™×˜ ×¦×£ ×§×™×™× ××‘×œ ×œ× × ×¨××”';
                }
            } else {
                console.error('âŒ Floating menu not found after text selection');
                document.getElementById('selection-status').textContent += ' | âŒ ×ª×¤×¨×™×˜ ×¦×£ ×œ× × ××¦×';
            }
        }

        function monitorMenuClicks() {
            const menu = document.getElementById('betterme-floating-menu');
            if (menu) {
                const button = menu.querySelector('button');
                if (button) {
                    console.log('ğŸ‘€ Monitoring clicks on floating menu button');
                    
                    // Add click event listener for monitoring
                    button.addEventListener('click', function(e) {
                        console.log('ğŸ”¥ DETECTED: Click on floating menu button!');
                        console.log('ğŸ”¥ Button text:', button.textContent);
                        console.log('ğŸ”¥ Event target:', e.target);
                        
                        // Check if dialog opens after click
                        setTimeout(() => {
                            const dialog = document.getElementById('betterme-summary-dialog');
                            if (dialog) {
                                console.log('âœ… Dialog opened after menu click');
                                document.getElementById('selection-status').textContent += ' | âœ… ×“×™××œ×•×’ × ×¤×ª×—!';
                            } else {
                                console.error('âŒ Dialog did NOT open after menu click');
                                document.getElementById('selection-status').textContent += ' | âŒ ×“×™××œ×•×’ ×œ× × ×¤×ª×—!';
                            }
                        }, 500);
                    }, { capture: true });
                }
            }
        }

        // Initial checks
        setTimeout(() => {
            console.log('ğŸš€ Starting extension diagnostics...');
            checkExtension();
            setTimeout(checkFunctions, 500);
            setTimeout(checkMenu, 1000);
        }, 1000);

        // Global error handler
        window.addEventListener('error', (e) => {
            console.error('ğŸš¨ JavaScript Error:', e.message, 'at', e.filename + ':' + e.lineno);
        });

        console.log('ğŸ”§ Debug page loaded, starting diagnostics...');
    </script>
</body>
</html>
